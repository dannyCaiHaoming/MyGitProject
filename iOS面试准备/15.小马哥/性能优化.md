

### CPU和GPU

#### CPU功能

- Layout
- Display
- 编解码
- **

#### GPU功能





### 屏幕成像原理

先发出一个(Vsync)垂直同步信号，然后会一行行的发出（Hsync）水平同步信号，更新每一行的数据。



### 卡顿产生的原因



#### CPU卡顿优化

- 尽量用轻量级对象，例如CALayer取代UIView
- 不要频繁调整UIView相关属性，frame，bounds，transform，
- 尽量提前计算好布局，
- Autolayout会比设置frame消耗更多
- 图片的size最好和UIImageView的size一样，就不会过多使用无效资源
- 控制一下线程最大并发数量，线程切换也会耗时
- 大量耗时可以放到子线程
  - 图片处理，解码，绘制
  - 文本处理，尺寸计算



#### GPU卡顿优化

- 尽量减少视图数量和层次？
- 尽量避免短时间内大量图片的显示，尽可能将多张图片合成一张图片
- 尽量减少透明视图，混合计算
- 减少离屏渲染



### 离屏渲染

##### OpenGL中，GPU有两个渲染方式

- On-Screen Rendering：当前屏幕渲染，在当前用于显示的屏幕缓冲区进行渲染

- Off-Screen Rending： 离屏渲染，在当前屏幕缓冲区以外开辟一个缓冲区进行渲染操作

##### 离屏渲染消耗性能的原因

- 需要创建新的缓冲区
- 需要多次切换上下文。先从当前渲染的缓冲区切换到另外开辟的缓冲区进行渲染结束后，又要切回到当前缓冲区切回到当前渲染的缓冲区。



##### 哪些操作会造成离屏渲染





### 卡顿检测

通过Runloop检测结束休眠到重新处理source0的之间的时间。





