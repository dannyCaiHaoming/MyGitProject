### 简介

有固定步骤，增加发现和利用每个影响目标的可能的漏洞的机会。

- 侦查
- 枚举
- 利用
- 维持访问
- 清理踪迹

如Web测试场景中，我们要尽可能识别网络、防火墙和入侵检测系统中所有可能组件。尽可能收集关于公司、网络和雇员的最大信息。



### 1. 使用Nmap扫描和识别服务

Nmap可能是世界上最广发使用的端口扫描器。可以用于识别活动主机、扫描TCP和UDP开放端口，检测防火墙，获得运行在远程主机上的服务版本，甚至是利用脚本来发现和利用漏洞。



#### 工作原理

Nmap是个端口扫描器，意味着它可以向一些指定IP的TCP或UDP端口发送封包，并且检查是否有响应。



#### 更多





### 2. 识别Web应用防火墙

Web应用防火墙（WAF）是一个设备或软件，可以检查发送到Web服务器的封包，以便识别和阻止可能的恶意封包，通常基于签名或者正则表达式。

如果未检测到的WAF组织了我们的请求或者封禁了我们的IP，我们渗透测试中就要处理很多的麻烦。在进行渗透测试的时候，侦查层面必须包含检测倍WAF，IDS（入侵检测系统），IPS（入侵阻止系统）。



##### 操作步骤



1. Nmap包含了一些脚本，用于测试WAF的存在。

```bash
nmap -p 80,443 --script=http-waf-detect 192.168.56.102
```



##### 工作原理

WAF检测的原理是通过发送特定请求到服务器，之后分析响应。例如，在`http-waf-detect`的例子中，发送了一些基本的恶意封包，并对比响应，同时查找封包被阻拦、拒绝或检测到的标识。





### 3. 查看源代码

查看网页的源代码允许我们理解一些程序的逻辑，检测明显的漏洞，以及在测试时有所参考，因为我们能够在测试之前和之后比较代码，并且使用比较结果来修改我们的下一次尝试。





##### 工作原理

网页的源代码在发现漏洞和分析应用对所提供的输入的响应上非常有用。它也提供给我们关于应用内部如何工作，以及它是否使用了任何第三方库或框架的信息。





### 5. 获取和修改cookie

Cookie是由服务器发送给浏览器（客户端）的小型信息片段，用于在本地存储一些信息，他们和特性用户相关。





### 6. 利用robots.txt







### 7. 使用DirBuster发现文件和文件夹

dirbuster是个工具，用于通过爆破来发现web服务器中现存文件和目录。



##### 工作原理

dirbuster是个爬虫和爆破组合，它允许页面上的所有连接，但是同时尝试可能文件的不同名称。这些名称可以保存在文件中。

- 200 OK： 文件存在并且能够读取
- 404 File not found：文件不存在
- 301 Moved permanently：到给定URL的重定向
- 401 Unauthorized：需要权限来访问文件
- 403 Forbidden：请求有效但是服务器拒绝响应



### 8. 使用cewl分析密码

侦查必须分析的层面是，分析应用、部门或过程的名称、以及其它被目标组织使用的单词。当需要设置人员相关的用户或密码的时候，这会帮助我们判断常被使用的组合。



### 9. 使用John the Ripper生成字典

允许我们对字典的单词使用规则、修改他们、以及在爆破中使用更丰富的单词列表而不用存储列表。



##### 工作原理

虽然John the Ripper目标不是字典生成器，而是高效地使用单词列表来破解密码。它的特性运行我们将其用于扩展现在有的单词列表，并创建更符合现代用户所使用的的密码字典。





### 10. 使用ZAP发现文件和文件夹





##### 工作原理

当我们配置浏览器来将ZAP用作代理的时候，它并不直接发送给服务器任何我们打算浏览页面的请求，而是发送到我们定义的地址。这里是ZAP监听的地址。之后ZAP将请求转发给服务器但是不分析任何我们发送的信息。

ZAP 的强制浏览的工作方式和 DIrBuster 相同，它接受我们所配置的字典，并向服务器发送请求，就像它尝试浏览列表中的文件那样。如果文件存在，服务器会相应地响应。如果文件不存在或不能被我们的当前用户访问，服务器会返回错误。