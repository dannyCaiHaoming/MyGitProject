#### 1. OWASP 2021 Top 10

顺序不知道重要不。先按照渗透步骤来记忆，先是资料搜集阶段，从公开主机漏洞关键字查找网络上公开的服务器。

- 04 不安全的设计   XML外部实体攻击
- 05 安全配置错误  debug环境上线
- 06 易受攻击或者过期的组件
- 07 识别与认证失败  密码被破解或者使用默认配置
- 08 软件和数据完整性失效 不安全反序列，即获取内容不正确

然后尝试开始对网站浏览，然后对可能存在漏洞的地方尝试手动挖掘。

- 01 访问控制失效   对身份认证没有做出限制
- 02 加密失败  敏感数据被暴漏
- 03 注入 
- 10 服务端请求伪造  

搜集完漏洞，最后对记录进行清除

- 9 安全日志与监控失败 



#### 2. SQL注入

原理： 代码没有对用户输入进行验证和处理便拼接到SQL查询语句中执行。

分类：

- 显注
- 盲注： 无回显，分成时间型，报错型，布尔型

危害：

1. 数据库信息泄露
2. 网页篡改
3. 网站被挂马，传播恶意软件
4. 数据库被恶意操作
5. 服务器被植入后门
6. 破坏硬盘或者服务器硬件

防护：

1. 关闭错误回显
2. 加waf
3. 对输入进行过滤
4. 限制输入长度
5. 限制数据库权限
6. 预编译sql语句
7. 数据库信息加密安全

绕过：

1. 关键字用%(只限于IIS系列)，如sel%e%ct
2. 内联注释，/\*!select\*/
3. 编码
4. multipart请求绕过，在post请求中添加文件，能绕过大多数waf
5. 参数绕过，id=1&id=2
6. 替换，如and可以用&&，=可以用like或in
7. 组合，and可以用&&再URL编码





#### 3. CSRF漏洞 - 跨站请求伪造

原理：  攻击者盗用了受害者身份，以受害者身份向服务器发起恶意的请求。

危害：

1. 修改受害者网站上的用户账户和数据
2. 账户劫持
3. 传播CSRF蠕虫进行大规模攻击
4. 对网站管理员
5. 拖库
6. 和其他漏洞组合使用
7. 针对路由器的csrf攻击

防护：

1. 尽量使用post，避免使用get
2. 浏览器cookie策略
3. 验证码
4. Referer check
5. Anti CSRF token



#### 4. 文件包含漏洞

分类：

1. 本地文件包含
2. 远程文件包含。需要在`php.ini`开启`allow_url_include`,`allow_url_fopen`

php文件包含函数：

1. `include()`只有代码执行到此函数才将文件包含进来，发生错误只警告
2. `include_once()`
3. `require()`只要程序执行，立即调用此函数包含文件，发生错误会输出错误并停止程序
4. `require_once()`

危害：

1. 读取敏感文件
2. shell控制主机

利用：

1. 图片上传并包含图片shell
2. 使用伪协议
3. 包含日志文件getshell
4. 截断包含

修复：

1. 禁止远程文件包含`allow_url_include=off`
2. 配置`open_basedir=指定目录`，限制访问区域
3. 过滤`../`等的特殊符号
4. 修改Apache日志文件的存放地址
5. 开启魔术引号`magic_quotes_qpc=on`，转义特殊字符
6. 尽量不要动态调用文件，如必须加白名单控制。



#### 5. 文件上传漏洞

原理：代码中没有对用户上传文件进行严格的校验，对文件内容、后缀、类型处理缺陷，导致用户可上传木马控制服务器。

危害：

操作木马文件提权，获取网站权限

绕过方法：

1. 白名单：

- 后缀名覆盖不全，`.php5`,`phtml`等
- 上传`.htaccess`
- 大小写
- 文件后缀前加空格
- 后缀名前加`.`
- 加上`::$DATA`,windows绕过
- 未循环验证， 因为有些逻辑只从最后开始处理只把最后的迷惑后缀去掉，`x.php..`

2. 黑名单 一般需要配合其他楼栋

- %00 截断
- 图片马
- 条件竞争

修复：

1. 在后端验证，防止前端抓包绕过
2. 使用自带函数检测
3. 基于白名单检测
4. 检测文件头，完整性检测
5. waf
6. 文件名重新生成，避免猜测出来，配合竞争条件读取
7. 图片进行二次渲染，避免中间插入代码