#### 客户端校验

使用合规后缀名去发送请求，抓取发送请求报文，将后缀名改回`php`



#### 服务端校验

##### 一般校验方式

1. 检查后缀名(白名单，黑名单)
2. 检查MIME（multiple internet mail extent），文件头Content-type
3. 检查文件内容头(GIF89a)
4. 文件内容检测，比较难。 检查内容是否合法或含有恶意代码。

##### 绕过方式

###### 1. 特殊后缀名绕过



###### 2. 修改`.htaccess`文件，如果能够上传。

`.htaccess`文件，提供针对每个目录改变配置的方法。但是只能应用在`Apache`服务器。

```ini
<FilesMatch "a.txt">  // 我们要上传的shell文件名
SetHandler application/x-httpd-php // 将文件按照php代码执行
</FilesMatch>
```



###### 3. `.user.ini`，适应面更广,只要是php且是CGI/FastCGI即可，上传目录有php文件

`.php.ini`是php的全局配置文件，对整个web服务起作用。

`.user.ini`和`.htaccess`都是目录配置文件。

- `auto_prepend_file`:表示插入到第一个php代码之前。类似包含
- `auto_append_file`：表示插入到第一个php代码之后。

```ini
#  如果校验文件内容，可以在`.user.ini`第一行加入`GIF89a`
GIF89a
auto_prepend_file="a.txt" // 双引号要不要都可以
auto_append_file="b.txt" // 双引号要不要都可以
```



#### 竞争条件攻击









### 题目：

###### 1. ctf.show_web13

尝试过一些绕过上传的后缀名，mime，等等，无果。

然后尝试.htaccess上传，也是error_size,应该是限制了内容长度。

知识不够。最终，需要上传的文件是`.user.ini`
